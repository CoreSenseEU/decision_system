<?xml version="1.0" encoding="UTF-8"?>
<root BTCPP_format="4">
  <include path="inspect_target_object.xml"/>
  <BehaviorTree ID="TargetNewObjectInRoom">
    <Sequence>
      <SubTree ID="DecideOnNewTargetObject"/>
      <SubTree ID="InspectTargetObject" target={target_object}/>
    </Sequence>
  </BehaviorTree>

    <!-- Decide on next target doorway object-->
  <BehaviorTree ID="DecideOnNewTargetObject">
    <Fallback>
      <SubTree ID="DecideOnNewTargetObjectElimination"
               _autoremap="true"/>
      <SubTree ID="DecideOnGraphRouteOneGoodReason"
               _autoremap="true"/>
    </Fallback>
  </BehaviorTree>


  <!-- TODO: define standard decision behavior tree
  _do
    _if first time
      get alternatives
      get cues
    _else
      update alternatives
      update cues
    assess
    aggregate
    order
    eliminate
  _while !accept
  _else fail

  -->


  <BehaviorTree ID="DecideOnNewTargetObjectElimination">
    <Sequence>
      <GetAlternativesQuery query="object(O), untidied(O), has_pose(O, Pobject), in_room(Pobject, R), in_room(Probot, R), robot_pose(Probot)"/>
      <GetCuesFixed cues="[object_type_is_book, unkown_object_type]"/>
      <AssessAlternatives name="action_assess" alternatives="{alternatives}" cues="{cues}"/>
      <AggregatePassAssessments name="aggregate_assessments" assessments="{assessments}"/>
      <OrderLexicographical name="order_lexicographical" evaluation="{evaluation}"/>
      <EliminateWorst name="eliminate_worst" ordering="{ordering}" choice="{choice}"/>
      <Fallback>
        <AcceptOne name="accept_one"/>
        <UpdateAlternativesTaken name="update_alternatives_taken" choice="{choice}"/>
      </Fallback>
    </Sequence>
  </BehaviorTree>

  <BehaviorTree ID="DecideOnGraphRouteOneGoodReason">
    <Sequence>
      <!-- Get alternatives from the input port -->
      <GetAlternativesFixed alternatives="{alternatives}"/>
      <GetCuesFixed cues="[path_length]"/>
      <AssessAlternatives name="action_assess" alternatives="{alternatives}" cues="{cues}"/>
      <AggregatePassAssessments name="aggregate_pass_assessments" assessments="{assessments}"/>
      <OrderLexicographical name="order_routes" evaluation="{evaluation}"/>
      <TakeN name="action_take_n" n="1" ordering="{ordering}"/>
      <!-- In a behavior tree, AcceptAlways can be omitted and keep the 
           same behavior, as long as the typing is correct. -->
      <AcceptAlways name="action_accept_always" choice="{choice}"/>
    </Sequence>
  </BehaviorTree>

</root>
